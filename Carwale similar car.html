<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CarWale Compare ‚Äî Dynamic Demo</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f5f8fb; --card:#ffffff; --accent:#0d6efd; --muted:#6b7280; --success:#198754;
      --glass: rgba(13,110,253,0.06);
    }
    body{font-family: Inter, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:#102030}
    .wrap{max-width:1200px;margin:28px auto;padding:18px}
    h1{margin:0 0 10px 0;font-size:20px}
    .personalization{display:flex;gap:12px;flex-wrap:wrap;background:#eaf4ff;padding:12px;border-radius:10px}
    .group{min-width:170px}
    .group label{display:block;font-weight:700;margin-bottom:6px;font-size:13px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:#fff;padding:8px 11px;border-radius:9px;border:1px solid #dbeeff;cursor:pointer;font-weight:700;user-select:none}
    .chip.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 6px 18px var(--glass)}
    .hero{display:flex;justify-content:space-between;align-items:center;margin-top:14px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .badges{display:flex;gap:8px;align-items:center}
    .badge{background:#ffd34d;padding:6px 10px;border-radius:8px;font-weight:800}
    .key-specs{display:flex;gap:14px;font-weight:700;color:#1f2937}
    .cta button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .layout{display:flex;gap:16px;margin-top:16px;align-items:flex-start}
    .main{flex:1;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .aside{width:320px}
    .spec-section{margin-top:10px}
    .spec-section h3{margin:0 0 8px 0;border-bottom:1px solid #f3f6fb;padding-bottom:6px}
    .spec-row{display:grid;grid-template-columns:1fr 140px 140px;gap:12px;padding:10px 0;align-items:center;border-bottom:1px dashed #f3f6fb;transition:background .4s,opacity .4s}
    .spec-title{font-weight:700}
    .spec-val{font-weight:800}
    .spec-note{font-size:12px;color:var(--muted);font-weight:600}
    .spec-i{font-size:13px;color:var(--accent);margin-left:8px;cursor:pointer}
    .spec-row.relevant{background:linear-gradient(90deg,#fffbe6,#fff);border-radius:6px}
    .toggle-diff{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;color:var(--muted)}
    .charts{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    canvas{background:#fff;border-radius:8px;padding:6px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .verdict{display:flex;gap:12px;align-items:center;padding:10px;margin-top:12px;background:linear-gradient(90deg,#f8fdf7,#ffffff);border-radius:10px}
    .score-circle{width:90px;height:90px;border-radius:50%;display:grid;place-items:center;font-weight:900;font-size:20px;color:#fff;background:linear-gradient(180deg,#0d6efd,#0b5cd6);box-shadow:0 6px 18px rgba(13,110,253,0.18)}
    .car-block{display:flex;flex-direction:column;gap:6px}
    .car-title{font-weight:900}
    .progress{height:10px;background:#eef6ff;border-radius:8px;overflow:hidden}
    .progress-bar{height:10px;background:linear-gradient(90deg,#0d6efd,#28a745);width:0%;transition:width .9s cubic-bezier(.2,.9,.2,1)}
    .tooltip{position:fixed;background:#fff;padding:10px;border-radius:8px;box-shadow:0 6px 24px rgba(2,6,23,0.12);max-width:320px;display:none;z-index:999}
    .footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:980px){.layout{flex-direction:column}.aside{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CarWale ‚Äî Compare (Dynamic Decision Engine Demo)</h1>

    <!-- PERSONALIZATION -->
    <div class="personalization" id="personal">
      <div class="group">
        <label>Usage</label>
        <div class="chips" id="usageChips">
          <div class="chip" data-val="daily">üöó Daily</div>
          <div class="chip" data-val="weekend">üèï Weekend</div>
          <div class="chip active" data-val="mixed">üõ£ Mixed</div>
          <div class="chip" data-val="offroad">üèú Off-road</div>
        </div>
      </div>

      <div class="group">
        <label>Passengers</label>
        <div class="chips" id="paxChips">
          <div class="chip" data-val="1-2">1‚Äì2</div>
          <div class="chip active" data-val="3-4">3‚Äì4</div>
          <div class="chip" data-val="5-7">5‚Äì7</div>
        </div>
      </div>

      <div class="group">
        <label>Priority (pick 1)</label>
        <div class="chips" id="priorityChips">
          <div class="chip" data-val="safety">üõ° Safety</div>
          <div class="chip" data-val="mileage">‚õΩ Mileage</div>
          <div class="chip active" data-val="power">‚ö° Power</div>
          <div class="chip" data-val="comfort">üí∫ Comfort</div>
          <div class="chip" data-val="purchase">üí∞ Low Purchase</div>
          <div class="chip" data-val="running">üîß Low Running</div>
        </div>
      </div>

      <div class="group">
        <label>Show</label>
        <div class="chips">
          <div class="chip" id="onlyDiffBtn">Show only differences</div>
        </div>
      </div>
    </div>

    <!-- HERO -->
    <div class="hero">
      <div class="badges">
        <div class="badge" id="bestTag">Best for Performance</div>
        <div style="font-size:13px;color:#213041;margin-left:8px">Comparing <strong>Mahindra Thar</strong> vs <strong>Mahindra Scorpio N</strong></div>
      </div>

      <div class="key-specs" id="heroSpecs">
        <div>üíµ ‚Çπ12.99‚Äì24.54L</div>
        <div>‚õΩ 10‚Äì18 kmpl</div>
        <div>‚ö° 117‚Äì197 bhp</div>
        <div>üõ° 4‚Äì5‚òÖ</div>
      </div>

      <div class="cta">
        <button onclick="alert('Test Drive flow ‚Äî demo')">Book Test Drive</button>
      </div>
    </div>

    <!-- LAYOUT -->
    <div class="layout">
      <div class="main">
        <div class="toggle-diff">
          <div><strong>Specs</strong> ‚Äî weighted by your priorities</div>
          <div><label style="font-weight:700;color:var(--muted)"><input type="checkbox" id="diffOnly"> Only differences</label></div>
        </div>

        <!-- PERFORMANCE -->
        <div class="spec-section" id="section-performance">
          <h3>Performance</h3>
          <div class="spec-row" data-cat="power">
            <div class="spec-title">Engine Power (bhp) <span class="spec-i" data-i="power" title="info">i</span></div>
            <div class="spec-val" id="powerA">117 bhp</div>
            <div class="spec-val" id="powerB">197 bhp</div>
          </div>
          <div class="spec-row" data-cat="power">
            <div class="spec-title">Torque (Nm) <span class="spec-i" data-i="torque" title="info">i</span></div>
            <div class="spec-val" id="torqueA">300 Nm</div>
            <div class="spec-val" id="torqueB">370 Nm</div>
          </div>
          <div class="spec-row" data-cat="power">
            <div class="spec-title">4x4 / Off-road</div>
            <div class="spec-val" id="fourA">Available (4x4)</div>
            <div class="spec-val" id="fourB">Available (4x4)</div>
          </div>
        </div>

        <!-- COMFORT -->
        <div class="spec-section" id="section-comfort">
          <h3>Comfort & Space</h3>
          <div class="spec-row" data-cat="comfort">
            <div class="spec-title">Seating Capacity</div>
            <div class="spec-val" id="seatA">5</div>
            <div class="spec-val" id="seatB">6‚Äì7</div>
          </div>
          <div class="spec-row" data-cat="comfort">
            <div class="spec-title">Boot Space (L) <span class="spec-i" data-i="boot" title="info">i</span></div>
            <div class="spec-val" id="bootA">600 L</div>
            <div class="spec-val" id="bootB">786 L</div>
          </div>
          <div class="spec-row" data-cat="comfort">
            <div class="spec-title">Infotainment</div>
            <div class="spec-val" id="infA">10.25\" Dual</div>
            <div class="spec-val" id="infB">8\" Touch</div>
          </div>
        </div>

        <!-- SAFETY -->
        <div class="spec-section" id="section-safety">
          <h3>Safety</h3>
          <div class="spec-row" data-cat="safety">
            <div class="spec-title">Adult NCAP Rating <span class="spec-i" data-i="ncap" title="info">i</span></div>
            <div class="spec-val" id="ncapA">4‚òÖ</div>
            <div class="spec-val" id="ncapB">5‚òÖ</div>
          </div>
          <div class="spec-row" data-cat="safety">
            <div class="spec-title">Airbags</div>
            <div class="spec-val" id="airA">2</div>
            <div class="spec-val" id="airB">6</div>
          </div>
          <div class="spec-row" data-cat="safety">
            <div class="spec-title">ADAS / Safety Tech <span class="spec-i" data-i="adas" title="info">i</span></div>
            <div class="spec-val" id="adasA">Level 1</div>
            <div class="spec-val" id="adasB">Level 2</div>
          </div>
        </div>

        <!-- COST -->
        <div class="spec-section" id="section-cost">
          <h3>Cost of Ownership</h3>
          <div class="spec-row" data-cat="cost">
            <div class="spec-title">Ex-Showroom (‚Çπ L)</div>
            <div class="spec-val" id="priceA">12.99</div>
            <div class="spec-val" id="priceB">13.85</div>
          </div>
          <div class="spec-row" data-cat="cost">
            <div class="spec-title">Estimated Mileage (kmpl)</div>
            <div class="spec-val" id="mileageA">10‚Äì12</div>
            <div class="spec-val" id="mileageB">14‚Äì18</div>
          </div>
          <div class="spec-row" data-cat="cost">
            <div class="spec-title">Estimated 5yr Running Cost (L)</div>
            <div class="spec-val" id="runA">4.2</div>
            <div class="spec-val" id="runB">5.8</div>
          </div>
        </div>

        <!-- FEATURE GAPS -->
        <div style="margin-top:12px;padding:10px;background:#fff7f0;border-radius:8px;border:1px solid #ffe6d5">
          <strong>Feature Gaps</strong>: Thar lacks some advanced airbags & rear AC vents. Scorpio N lacks removable roof & is less nimble for tight offroad.
        </div>

        <!-- CHARTS -->
        <div class="charts">
          <canvas id="radar" width="360" height="300"></canvas>
          <canvas id="bar" width="360" height="300"></canvas>
        </div>

      </div>

      <!-- ASIDE -->
      <div class="aside">
        <div style="background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04)">
          <div style="font-weight:900;margin-bottom:8px">Final Recommendation</div>
          <div class="verdict">
            <div class="score-circle" id="finalScore">--</div>
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-weight:900" id="winnerTitle">‚Äî</div>
                  <div style="font-size:13px;color:var(--muted)" id="winnerSub">Match to your priorities</div>
                </div>
              </div>
              <div style="margin-top:10px">
                <div style="display:flex;gap:8px;align-items:center">
                  <div style="width:45%;font-size:13px">Mahindra Thar</div>
                  <div style="width:55%;">
                    <div class="progress"><div id="barA" class="progress-bar" style="width:0%"></div></div>
                  </div>
                </div>
                <div style="height:8px"></div>
                <div style="display:flex;gap:8px;align-items:center">
                  <div style="width:45%;font-size:13px">Scorpio N</div>
                  <div style="width:55%;">
                    <div class="progress"><div id="barB" class="progress-bar" style="width:0%"></div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top:12px;font-size:13px;color:var(--muted)">
            <strong>Why this pick?</strong>
            <div id="reasonText" style="margin-top:6px">‚Äî</div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="chip" onclick="alert('Book Test Drive demo')">Book Test Drive</button>
            <button class="chip" onclick="alert('See Offers demo')">View Offers</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div style="background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04)">
          <div style="font-weight:900;margin-bottom:8px">Owner Ratings</div>
          <div style="margin-bottom:8px">Comfort: <strong>4.2‚òÖ</strong></div>
          <div style="margin-bottom:8px">Mileage: <strong>3.9‚òÖ</strong></div>
          <div style="margin-bottom:8px">Reliability: <strong>4.0‚òÖ</strong></div>
        </div>
      </div>
    </div>

    <div class="footer">Prototype ‚Äî Data is indicative. Use this demo to test decision flows & metrics.</div>

    <!-- tooltip -->
    <div id="tooltip" class="tooltip"></div>
  </div>

  <script>
    /*******************************
     * Hardcoded specs (Thar = A, Scorpio N = B)
     *******************************/
    const specs = {
      power: {A:117, B:197},       // bhp
      torque: {A:300, B:370},      // Nm
      boot: {A:600, B:786},        // L
      seat: {A:5, B:6.5},          // numeric (6‚Äì7 -> 6.5)
      ncap: {A:4, B:5},            // star
      airbags: {A:2, B:6},
      adas: {A:1, B:2},            // level
      price: {A:12.99, B:13.85},   // L (lower better)
      mileage: {A:11, B:16},       // avg kmpl
      running5y: {A:4.2, B:5.8}    // L (lower better -> lower is better)
    };

    /*******************************
     * Category to spec mapping
     *******************************/
    const categories = {
      safety: ['ncap','airbags','adas'],
      mileage: ['mileage','running5y'],
      power: ['power','torque'],
      comfort: ['seat','boot','infotainment'], // infotainment exists textually; we won't normalize it numerically
      cost: ['price','running5y','mileage']
    };

    /*******************************
     * Weight matrix (1-5 scale)
     * Rows = priority selection
     *******************************/
    const weightMatrix = {
      safety:    {safety:5,mileage:3,power:2,comfort:3,cost:2},
      mileage:   {safety:2,mileage:5,power:2,comfort:3,cost:4},
      power:     {safety:2,mileage:2,power:5,comfort:3,cost:2},
      comfort:   {safety:2,mileage:3,power:2,comfort:5,cost:3},
      purchase:  {safety:2,mileage:3,power:2,comfort:3,cost:5},
      running:   {safety:2,mileage:4,power:2,comfort:3,cost:5}
    };

    /*******************************
     * Normalize functions per spec
     * map raw value to 0-10 scale (higher is better)
     *******************************/
    function normalize(specKey, val){
      // for inverted metrics (lower better) return higher for lower values
      switch(specKey){
        case 'power': return scale(val, 80, 220);       // bhp: 80->0 ; 220->10
        case 'torque': return scale(val, 180, 420);     // Nm
        case 'boot': return scale(val, 200, 900);
        case 'seat': return scale(val, 2, 7);
        case 'ncap': return scale(val, 1, 5);
        case 'airbags': return scale(val, 0, 8);
        case 'adas': return scale(val, 0, 3);
        case 'price': return invertScale(val, 8, 30);   // lower price better; ex. 8L -> best, 30L -> worst
        case 'mileage': return scale(val, 6, 22);
        case 'running5y': return invertScale(val, 3, 12);
        default: return 5;
      }
    }

    function scale(x, min, max){
      let v = (x - min) / (max - min) * 10;
      if(v<0) v=0; if(v>10) v=10;
      return v;
    }
    function invertScale(x, min, max){
      let v = (max - x) / (max - min) * 10;
      if(v<0) v=0; if(v>10) v=10;
      return v;
    }

    /*******************************
     * Category score: average of normalized spec scores in that category
     *******************************/
    function categoryScoreForCar(cat, car){
      const specKeys = categories[cat];
      let sum=0, count=0;
      specKeys.forEach(k => {
        if(specs[k] && typeof specs[k][car] !== 'undefined'){
          sum += normalize(k, specs[k][car]);
          count++;
        }
      });
      return count? sum/count : 0;
    }

    /*******************************
     * Compute final weighted score
     *******************************/
    function computeScores(priorityKey){
      const weights = weightMatrix[priorityKey];
      // sum weights for normalization
      let weightSum = 0;
      for(let c in weights) weightSum += weights[c];
      // compute category scores
      const catScoresA = {};
      const catScoresB = {};
      for(let cat of ['safety','mileage','power','comfort','cost']){
        catScoresA[cat] = categoryScoreForCar(cat, 'A');
        catScoresB[cat] = categoryScoreForCar(cat, 'B');
      }
      // weighted sum normalized to 0-100
      let totalA=0, totalB=0;
      for(let cat in weights){
        totalA += catScoresA[cat] * weights[cat];
        totalB += catScoresB[cat] * weights[cat];
      }
      const maxPossible = 10 * weightSum; // if every cat had 10
      const scoreA = Math.round((totalA / maxPossible) * 100);
      const scoreB = Math.round((totalB / maxPossible) * 100);
      return {
        catScoresA, catScoresB, scoreA, scoreB, weights
      };
    }

    /*******************************
     * UI Hooks & Chart setup
     *******************************/
    // chips behavior
    document.querySelectorAll('#priorityChips .chip').forEach(ch=>{
      ch.addEventListener('click', function(){
        document.querySelectorAll('#priorityChips .chip').forEach(x=>x.classList.remove('active'));
        this.classList.add('active');
        recomputeAndRender();
      });
    });
    document.querySelectorAll('#paxChips .chip, #usageChips .chip').forEach(ch=>{
      ch.addEventListener('click', function(){
        // single select for pax, multi for usage (but UX choice: pax single)
        if(this.parentElement.id==='paxChips'){
          document.querySelectorAll('#paxChips .chip').forEach(x=>x.classList.remove('active'));
          this.classList.add('active');
        } else {
          this.classList.toggle('active');
        }
        // usage/pax currently not used in scoring, but could affect weights later
      });
    });

    // diff toggle
    document.getElementById('diffOnly').addEventListener('change', function(){
      const checked = this.checked;
      document.querySelectorAll('.spec-row').forEach(row=>{
        const vals = row.querySelectorAll('.spec-val');
        if(vals.length===2){
          if(vals[0].innerText.trim() === vals[1].innerText.trim()){
            row.style.display = checked ? 'none' : 'grid';
          } else row.style.display = 'grid';
        }
      });
    });

    // tooltip for info buttons
    const tooltip = document.getElementById('tooltip');
    document.querySelectorAll('.spec-i').forEach(i=>{
      i.addEventListener('click', function(ev){
        const key = this.dataset.i;
        showInfoTooltip(key, ev.clientX, ev.clientY);
      });
    });
    document.addEventListener('click', function(e){
      if(!e.target.classList.contains('spec-i')) tooltip.style.display='none';
    });

    function showInfoTooltip(key, x, y){
      const texts = {
        power: "<strong>Engine Power</strong><br/>Power (bhp) influences top speed & acceleration. Higher values give better overtaking/pulling ability.",
        torque: "<strong>Torque</strong><br/>Torque (Nm) is the pulling force; higher torque helps with hill climbs and carrying loads.",
        boot: "<strong>Boot Space</strong><br/>Measured in litres. Bigger boot is better for luggage & family trips.",
        ncap: "<strong>Adult NCAP</strong><br/>Crash-test rating (stars) ‚Äî higher is safer. It's an independent safety assessment.",
        adas: "<strong>ADAS (Safety Tech)</strong><br/>Advanced Driver Assistance Systems (lane-keep, AEB). Higher levels = more automation.",
      };
      tooltip.innerHTML = texts[key] || 'Info';
      tooltip.style.left = (x + 12) + 'px';
      tooltip.style.top = (y + 12) + 'px';
      tooltip.style.display = 'block';
    }

    // chart.js initial configs
    const radarCtx = document.getElementById('radar').getContext('2d');
    const barCtx = document.getElementById('bar').getContext('2d');
    let radarChart, barChart;

    function initCharts(labels, dataA, dataB){
      if(radarChart) radarChart.destroy();
      radarChart = new Chart(radarCtx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [
            {label:'Thar', data:dataA, fill:true, backgroundColor:'rgba(13,110,253,0.10)', borderColor:'#0d6efd', pointBackgroundColor:'#0d6efd'},
            {label:'Scorpio N', data:dataB, fill:true, backgroundColor:'rgba(25,135,84,0.08)', borderColor:'#198754', pointBackgroundColor:'#198754'}
          ]
        },
        options: {
          maintainAspectRatio:false,
          scales: { r: { min:0, max:10, ticks: { stepSize:2 } } },
          animation: { duration: 800, easing: 'easeOutQuart' }
        }
      });

      if(barChart) barChart.destroy();
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: ['Ex-showroom (L)','Est. 5yr Running (L)'],
          datasets:[
            {label:'Thar', data:[specs.price.A, specs.running5y.A], backgroundColor:'#0d6efd'},
            {label:'Scorpio N', data:[specs.price.B, specs.running5y.B], backgroundColor:'#198754'}
          ]
        },
        options: {
          maintainAspectRatio:false,
          animation:{ duration:800, easing:'easeOutQuart' },
          plugins:{ legend:{position:'top'} }
        }
      });
    }

    /*******************************
     * Animated number (count up)
     *******************************/
    function animateValue(el, start, end, duration=800){
      const startTime = performance.now();
      function step(now){
        const elapsed = now - startTime;
        const progress = Math.min(elapsed/duration,1);
        const value = Math.round(start + (end - start) * progress);
        el.innerText = value + '%';
        if(progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function animateProgressBar(el, percent){
      el.style.width = Math.max(0, Math.min(100, percent)) + '%';
    }

    /*******************************
     * Recompute & render UI
     *******************************/
    function recomputeAndRender(){
      const priority = document.querySelector('#priorityChips .chip.active').dataset.val;
      document.getElementById('bestTag').innerText = {
        safety:'Best for Safety',
        mileage:'Best for Mileage',
        power:'Best for Performance',
        comfort:'Best for Comfort',
        purchase:'Best for Price',
        running:'Best for Low Running Cost'
      }[priority] || 'Best Fit';

      const result = computeScores(priority);
      // update verdict numbers with animation
      const finalEl = document.getElementById('finalScore');
      animateValue(finalEl, parseInt(finalEl.innerText) || 0, Math.max(result.scoreA, result.scoreB), 900);

      // winner title
      const winner = result.scoreA > result.scoreB ? 'Mahindra Thar' : (result.scoreB > result.scoreA ? 'Mahindra Scorpio N' : 'Tie');
      document.getElementById('winnerTitle').innerText = winner;
      document.getElementById('winnerSub').innerText = `Thar ${result.scoreA}% ‚Ä¢ Scorpio N ${result.scoreB}% (based on your priorities)`;

      // progress bars
      animateProgressBar(document.getElementById('barA'), result.scoreA);
      animateProgressBar(document.getElementById('barB'), result.scoreB);

      // reason text
      let reason = '';
      if(result.scoreA > result.scoreB) reason = `Thar suits you because it scores higher in categories you prioritised.`;
      else if(result.scoreB > result.scoreA) reason = `Scorpio N suits you because it scores higher in categories you prioritised.`;
      else reason = `Both cars are closely matched for your selected priorities.`;
      document.getElementById('reasonText').innerText = reason;

      // highlight relevant spec-rows based on weights (>=3 considered relevant)
      document.querySelectorAll('.spec-row').forEach(row=>{
        const cat = row.dataset.cat;
        const w = result.weights[cat] || 0;
        if(w >= 3) row.classList.add('relevant'); else row.classList.remove('relevant');
      });

      // radar chart: categories order
      const catLabels = ['Safety','Mileage','Power','Comfort','Cost'];
      const dataA = [
        result.catScoresA.safety,
        result.catScoresA.mileage,
        result.catScoresA.power,
        result.catScoresA.comfort,
        result.catScoresA.cost
      ];
      const dataB = [
        result.catScoresB.safety,
        result.catScoresB.mileage,
        result.catScoresB.power,
        result.catScoresB.comfort,
        result.catScoresB.cost
      ];
      // init or update charts
      if(!radarChart) initCharts(catLabels, dataA, dataB);
      else {
        radarChart.data.labels = catLabels;
        radarChart.data.datasets[0].data = dataA;
        radarChart.data.datasets[1].data = dataB;
        radarChart.update();
        // update bar chart numbers if you like (we keep bar chart static as price/running)
      }
    }

    // initial render
    recomputeAndRender();

    // trigger recompute on priority changes elsewhere (if needed)
    document.querySelectorAll('#priorityChips .chip').forEach(ch=>ch.addEventListener('click', recomputeAndRender));
    document.getElementById('onlyDiffBtn').addEventListener('click', function(){
      const el = document.getElementById('diffOnly');
      el.checked = !el.checked;
      el.dispatchEvent(new Event('change'));
    });

    // small accessibility: hide tooltip on esc
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') tooltip.style.display='none' });

  </script>
</body>
</html>
